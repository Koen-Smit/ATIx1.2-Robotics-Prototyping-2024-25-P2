@page "/"
@attribute [StreamRendering]
@rendermode InteractiveServer
@inject NavigationManager NavigationManager

<PageTitle>Robot</PageTitle>



<div class="card battery-card top-0 end-0 m-3 shadow">
    <div class="card-body p-3">
        <h5 class="card-title">Robot status</h5>
        @* ==================================================={ BATTERY }===================================================*@  
        @if (BatteryService!.batteries != null && BatteryService.batteries.Any()) 
        {
            foreach (var battery in BatteryService.batteries)
            {
                <div class="battery-container">
                    <div class="battery" @onclick="BatteryService!.LoadBatteries" style="cursor: pointer;">
                        <div class="battery-fill" 
                            style="width: @Math.Min(battery.Percentage, 100)%; background-color: @(BatteryService?.GetBatteryColor(battery.Percentage) ?? "gray");">
                            <span class="battery-percentage">@Math.Min(BatteryService!.batteries[0].Percentage, 100)%</span>
                        </div>
                    </div>
                    <span class="battery-name">Laatste batterij update: @battery.Timestamp.ToString("HH:mm")</span>
                </div>
            }
        }
        else
        {
            <button class="btn battery-placeholder" @onclick="BatteryService!.LoadBatteries" title="Load Battery Status">Load battery status</button>
        }
        
        @* ==================================================={ STOP-BUTTON }===================================================*@
        <div class="mt-4">
            @if (StopService!.robotStatus == "Robot stopped.")
            {
                <!-- Render the Start Robot button if the robot is stopped -->
                <button class="btn btn-success" @onclick="StopService.StartRobot" title="Start de robot">
                    Start Robot
                </button>
            }
            else
            {
                <!-- Render the Stop Robot button if the robot is running -->
                <button class="btn btn-danger" @onclick="StopService.StopRobot" title="Stop de robot">
                    Stop Robot
                </button>
            }

            @if (!string.IsNullOrEmpty(StopService.robotStatus))
            {
                <p>Status: @StopService.robotStatus</p>
            }
            else
            {
                <p>Status: Robot draait.</p>
            }
        </div>
        <button class="border-0 refresh-button ms-2" title="Refresh" @onclick="RefreshPage">
            <i class="bi bi-arrow-clockwise"></i>
        </button>
    </div>
</div>

@* ==================================================={ TASK FORM }===================================================*@
<h5 class="mt-4">Voeg een nieuwe taak toe</h5>

<EditForm Model="taskType" OnValidSubmit="HandleValidSubmit">
    <DataAnnotationsValidator />
    <ValidationSummary />

    <div class="form-group">
        <label for="taskName">Taaknaam</label>
        <InputText id="taskName" class="form-control" @bind-Value="taskType.TypeName" />
    </div>

    <div class="form-group">
        <label for="taskDescription">Taakbeschrijving</label>
        <InputTextArea id="taskDescription" class="form-control" @bind-Value="taskType.Description" />
    </div>

    <button type="submit" class="btn btn-primary mt-3">Taak toevoegen</button>
</EditForm>

@if (isTaskAdded)
{
    <div class="alert alert-success mt-3">
        Taak type succesvol toegevoegd!
    </div>
}
